
#GCC笔记#

`gcc/g++`在编译过程中会用到如下的几种后缀名。

`.c`，`.C`，`.cc`，`.cxx`，`.cpp`这些后缀名是源程序，后面四种都是`C++`源程序，编译过程中需要经过预处理，编译，汇编三个过程，最终形成目标文件；`.m`是`Objective-C`源程序，它也需要经过预处理，编译和汇编过程。`.i`为预处理后的C文件，后面需要经过编译和汇编；`.ii`为预处理后的`C++`文件，编译为目标文件也需要经过编译和汇编。`.s`为汇编语言源程序，只需汇编即可；`.S`也是汇编源程序，但是它需要进行预处理，处理后即`.s`文件。`.h`为头文件，即预处理要处理的文件。


###GCC常用参数列表###

**-o outfile**: 指定输出的文件的名字，默认为a.out。

**-g**: 编译代码是保留调试信息，`-gX`中X表示调试信息的级别，如果`X=3`，则表示要保留宏定义符号。

**-Wall**: 输出所有的警告信息。

**-E**: 只做预处理，不进行编译，`cpp`命令可以达到类似效果。

**-S**: 编译生成汇编代码，不汇编为目标文件。

**-c**: 编译或汇编源文件，不作链接，只输出源文件的目标文件。使用`-o`可以指定目标文件的名字。

**-I dir**: （大写的I）将dir作为头文件搜索目录添加进来。

**-Dmacro**: 定义一个宏，macro的值为字符串`1`，可以使用`-Dmacro=defn`来指定宏的值。`-Umacro`用于取消宏`macro`的定义。

**-M**: 输出`a.o: a.c a.h b.h`类似的形式，`-MM`的输出不包括系统头文件。

**-MD/-MMD**: 和`-M`选项类似，但是把依赖信息输出到文件中，文件名通过把输出文件名末尾的`.o`替换为`.d`产生。

**-v**: 显示执行编译阶段的命令。同时显示编译器驱动程序，预处理器，编译器的版本号。

**-x language**: 明确指出输入文件的语言为language，可选的有`c`，`objective-c`，`c-header`，`c++`，`cpp-output`，`assembler`和`assembler-with-cpp`。不使用这个选项，则根据文件后缀名进行编译。

**-fno-builtin**: 禁止GCC编译器内置函数，即不接收非两个下划线开头的内建函数，比如`abort`，`alloca`，`exit`，`strlen`等。在编译内核时要使用该选项，否则gcc会将这些函数链接到系统内建函数上。

**-nostdinc**: 不要在标准系统目录中寻找头文件，只搜索`-I`选项指定的目录，以及当前目录。

**-march=i386**: 指定编译的目标平台为i386。

**-fno-stack-protector**: 编译中省略栈帧校验，即堆栈保护功能，对于编译内核等不依赖于标准库的程序时需要指定。

**-m32**: 在64位系统上将源码编译为32位程序。

**-O0**: 关闭所有的优化选项。

**-fPIC**: 使用地址无关代码模式进行编译，`Positioni Independent Code`。

**-fPIE**: 使用地址无关代码模式编译可执行文件，`Position Independent Executable`。

**-fomit-frame-pointer**: 禁止使用EBP作为函数帧指针。

**-ffunction-sections**: 将每个函数编译到独立的代码段。

**-fdata-sections**: 将全局变量/静态变量编译到独立的数据段。


###链接选项###

**-L dir**: 将dir作为库文件搜索目录添加进来。

**-llibname**: 链接liblibname.a库，除了搜索一些系统标准目录外，还包括用`-L`选项指定的路径。

**-nostartfiles**: 不要链接启动文件，比如`crtbegin.o`，`crtend.o`。

**-nostdlib**: 不连接系统标准启动文件和标准库文件，只要把指定文件传递给链接器。在编译内核时会用到该选项。

**-ffreestanding**: 编译独立的程序，不会自动链接C运行库，启动文件等

**-shared**: 生成一个共享目标文件，可以和其他的目标文件链接生成可执行文件。

**-fPIC**: 编译器输出位置无关目标码，适用于动态链接库。

**-m elf_i386**: 生成兼容i386机器的ELF文件。

**-Ttext 0**: 指定代码段入口地址

**-e main**: 指定代码段入口函数。

**-static**: 使用静态链接。

**-XLinker option**: 将option指定的选项传递给链接器。

**-W1 option**: 将option指定的选项传递给链接器。

###ld选项###

除了上述gcc中使用的连接选项之外，ld链接器还有更多自己的选项。

**-r**: 合并到目标文件，不进行最终链接。

**-M**: 将链接时的符号和地址输出位映射文件。

**-s**: 清除输出文件中的符号信息。

**-S**: 清除输出文件中的调试信息。

**-T scriptfile**: 指定链接脚本文件scriptfile。

**-soname name**: 指定输出共享库的SONAME，注意这里并非动态库的文件名。

**-export-dynamic**: 将全局符号全部导出。

**-verbose**: 链接时输出详细信息。

**-rpath path**: 指定链接时库查找路径。


By Andy@2018-12-24 09:38:38